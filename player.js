// Generated by CoffeeScript 2.7.0
import {
  echo,
  global,
  range
} from './global.js';

import {
  performance
} from './rating.js';

export var Player = class Player {
  constructor(id, name, elo1) {
    this.id = id;
    this.name = name;
    this.elo = elo1;
    this.opp = []; // används endast av Floating
    this.col = ""; // används endast av Floating
    this.summa = 0;
    this.P = 0;
    this.PR = 0;
  }

  balance() {
    var b, c, j, len, ref;
    b = 0;
    ref = this.col;
    for (j = 0, len = ref.length; j < len; j++) {
      c = ref[j];
      if (c === 'w') {
        b++;
      }
      if (c === 'b') {
        b--;
      }
    }
    return b;
  }

  toString() {
    return `${String(this.elo).padStart(4, '0')} ${this.name}`;
  }

  update_P_and_PR(longs, i) {
    var andel, ch, elo, j, len, long, opp, perf, r, ref, value;
    long = longs[i];
    echo('longs', longs);
    this.P = 0;
    this.PR = 0;
    this.elos = [];
    ref = range(global.settings.GAMES * global.settings.ROUNDS);
    for (j = 0, len = ref.length; j < len; j++) {
      r = ref[j];
      ch = long[r][3];
      value = '012'.indexOf(ch);
      opp = long[r][1];
      if (value !== -1) {
        elo = global.players[opp].elo;
        this.P += value / 2;
        if (elo !== 0) {
          this.PR += value / 2;
          this.elos.push(Math.round(elo));
        }
      }
    }
    // kalkylera performance rating mha vinstandel och elo-tal
    if (this.elos.length === 0) {
      return this.PR = 0;
    } else {
      andel = this.PR;
      perf = performance(andel, this.elos);
      return this.PR = perf;
    }
  }

};

// setP = (trs, index, translator) ->
// 	scoresP = 0
// 	scoresPR = 0
// 	elos = []
// 	for r in range settings.GAMES * settings.ROUNDS
// 		ch = longs[index][r][3]
// 		value = '012'.indexOf ch
// 		opp = longs[index][r][1]
// 		if value != -1
// 			elo = players[opp].elo
// 			scoresP += value
// 			if elo != 0
// 				scoresPR += value
// 				elos.push Math.round elo

// 	tdP  = trs[translator[index]].children[3 + settings.GAMES * settings.ROUNDS]
// 	tdP.textContent = if elos.length == 0 then '' else (scoresP/2).toFixed 1

// 	# kalkylera performance rating mha vinstandel och elo-tal
// 	if elos.length == 0 
// 		players[index].PR = 0
// 	else
// 		andel = scoresPR/2
// 		perf = performance andel, elos
// 		players[index].PR = perf

// setP_all = (trs,translator) ->
// 	#echo 'setP_all',longs.length,translator.length
// 	for i in range translator.length
// 		setP trs,i,translator

// setPR = (trs, index, translator) ->
// 	tdPR = trs[translator[index]].children[4 + settings.GAMES * settings.ROUNDS]
// 	tdPR.textContent = if players[index].PR == 0 then '' else players[index].PR.toFixed settings.DECIMALS

// setPR_all = (trs,translator) ->
// 	for i in range translator.length
// 		setPR trs,i,translator

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGxheWVyLmpzIiwic291cmNlUm9vdCI6IlxcIiwic291cmNlcyI6WyJwbGF5ZXIuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFBO0VBQVEsSUFBUjtFQUFhLE1BQWI7RUFBb0IsS0FBcEI7Q0FBQSxNQUFBOztBQUNBLE9BQUE7RUFBUSxXQUFSO0NBQUEsTUFBQTs7QUFFQSxPQUFBLElBQWEsU0FBTixNQUFBLE9BQUE7RUFFTixXQUFjLEdBQUEsTUFBQSxNQUFBLENBQUE7SUFBQyxJQUFDLENBQUE7SUFBSSxJQUFDLENBQUE7SUFBTSxJQUFDLENBQUE7SUFDM0IsSUFBQyxDQUFBLEdBQUQsR0FBTyxHQUFUO0lBQ0UsSUFBQyxDQUFBLEdBQUQsR0FBTyxHQURUO0lBRUUsSUFBQyxDQUFBLEtBQUQsR0FBUztJQUNULElBQUMsQ0FBQSxDQUFELEdBQUs7SUFDTCxJQUFDLENBQUEsRUFBRCxHQUFNO0VBTE87O0VBT2QsT0FBVSxDQUFBLENBQUE7QUFDWCxRQUFBLENBQUEsRUFBQSxDQUFBLEVBQUEsQ0FBQSxFQUFBLEdBQUEsRUFBQTtJQUFFLENBQUEsR0FBSTtBQUNKO0lBQUEsS0FBQSxxQ0FBQTs7TUFDQyxJQUFHLENBQUEsS0FBRyxHQUFOO1FBQWUsQ0FBQSxHQUFmOztNQUNBLElBQUcsQ0FBQSxLQUFHLEdBQU47UUFBZSxDQUFBLEdBQWY7O0lBRkQ7V0FHQTtFQUxTOztFQU9WLFFBQVUsQ0FBQSxDQUFBO1dBQUcsQ0FBQSxDQUFBLENBQUcsTUFBQSxDQUFPLElBQUMsQ0FBQSxHQUFSLENBQVksQ0FBQyxRQUFiLENBQXNCLENBQXRCLEVBQXlCLEdBQXpCLENBQUgsRUFBQSxDQUFBLENBQW1DLElBQUMsQ0FBQSxJQUFwQyxDQUFBO0VBQUg7O0VBRVYsZUFBa0IsQ0FBQyxLQUFELEVBQU8sQ0FBUCxDQUFBO0FBQ25CLFFBQUEsS0FBQSxFQUFBLEVBQUEsRUFBQSxHQUFBLEVBQUEsQ0FBQSxFQUFBLEdBQUEsRUFBQSxJQUFBLEVBQUEsR0FBQSxFQUFBLElBQUEsRUFBQSxDQUFBLEVBQUEsR0FBQSxFQUFBO0lBQUUsSUFBQSxHQUFPLEtBQUssQ0FBQyxDQUFEO0lBQ1osSUFBQSxDQUFLLE9BQUwsRUFBYSxLQUFiO0lBQ0EsSUFBQyxDQUFBLENBQUQsR0FBSztJQUNMLElBQUMsQ0FBQSxFQUFELEdBQU07SUFDTixJQUFDLENBQUEsSUFBRCxHQUFRO0FBQ1I7SUFBQSxLQUFBLHFDQUFBOztNQUNDLEVBQUEsR0FBSyxJQUFJLENBQUMsQ0FBRCxDQUFHLENBQUMsQ0FBRDtNQUNaLEtBQUEsR0FBUSxLQUFLLENBQUMsT0FBTixDQUFjLEVBQWQ7TUFDUixHQUFBLEdBQU0sSUFBSSxDQUFDLENBQUQsQ0FBRyxDQUFDLENBQUQ7TUFDYixJQUFHLEtBQUEsS0FBUyxDQUFDLENBQWI7UUFDQyxHQUFBLEdBQU0sTUFBTSxDQUFDLE9BQU8sQ0FBQyxHQUFELENBQUssQ0FBQztRQUMxQixJQUFDLENBQUEsQ0FBRCxJQUFNLEtBQUEsR0FBTTtRQUNaLElBQUcsR0FBQSxLQUFPLENBQVY7VUFDQyxJQUFDLENBQUEsRUFBRCxJQUFPLEtBQUEsR0FBTTtVQUNiLElBQUMsQ0FBQSxJQUFJLENBQUMsSUFBTixDQUFXLElBQUksQ0FBQyxLQUFMLENBQVcsR0FBWCxDQUFYLEVBRkQ7U0FIRDs7SUFKRCxDQUxGOztJQWlCRSxJQUFHLElBQUMsQ0FBQSxJQUFJLENBQUMsTUFBTixLQUFnQixDQUFuQjthQUNDLElBQUMsQ0FBQSxFQUFELEdBQU0sRUFEUDtLQUFBLE1BQUE7TUFHQyxLQUFBLEdBQVEsSUFBQyxDQUFBO01BQ1QsSUFBQSxHQUFPLFdBQUEsQ0FBWSxLQUFaLEVBQW1CLElBQUMsQ0FBQSxJQUFwQjthQUNQLElBQUMsQ0FBQSxFQUFELEdBQU0sS0FMUDs7RUFsQmlCOztBQWxCWjs7QUFIUCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7ZWNobyxnbG9iYWwscmFuZ2V9IGZyb20gJy4vZ2xvYmFsLmpzJ1xyXG5pbXBvcnQge3BlcmZvcm1hbmNlfSBmcm9tICcuL3JhdGluZy5qcydcclxuXHJcbmV4cG9ydCBjbGFzcyBQbGF5ZXJcclxuXHJcblx0Y29uc3RydWN0b3IgOiAoQGlkLCBAbmFtZSwgQGVsbykgLT5cclxuXHRcdEBvcHAgPSBbXSAjIGFudsOkbmRzIGVuZGFzdCBhdiBGbG9hdGluZ1xyXG5cdFx0QGNvbCA9IFwiXCIgIyBhbnbDpG5kcyBlbmRhc3QgYXYgRmxvYXRpbmdcclxuXHRcdEBzdW1tYSA9IDBcclxuXHRcdEBQID0gMFxyXG5cdFx0QFBSID0gMFxyXG5cclxuXHRiYWxhbmNlIDogLT5cclxuXHRcdGIgPSAwXHJcblx0XHRmb3IgYyBpbiBAY29sXHJcblx0XHRcdGlmIGM9PSd3JyB0aGVuIGIrK1xyXG5cdFx0XHRpZiBjPT0nYicgdGhlbiBiLS1cclxuXHRcdGJcclxuXHJcblx0dG9TdHJpbmc6IC0+IFwiI3tTdHJpbmcoQGVsbykucGFkU3RhcnQgNCwgJzAnfSAje0BuYW1lfVwiXHJcblxyXG5cdHVwZGF0ZV9QX2FuZF9QUiA6IChsb25ncyxpKSAtPlxyXG5cdFx0bG9uZyA9IGxvbmdzW2ldXHJcblx0XHRlY2hvICdsb25ncycsbG9uZ3NcclxuXHRcdEBQID0gMFxyXG5cdFx0QFBSID0gMFxyXG5cdFx0QGVsb3MgPSBbXVxyXG5cdFx0Zm9yIHIgaW4gcmFuZ2UgZ2xvYmFsLnNldHRpbmdzLkdBTUVTICogZ2xvYmFsLnNldHRpbmdzLlJPVU5EU1xyXG5cdFx0XHRjaCA9IGxvbmdbcl1bM11cclxuXHRcdFx0dmFsdWUgPSAnMDEyJy5pbmRleE9mIGNoXHJcblx0XHRcdG9wcCA9IGxvbmdbcl1bMV1cclxuXHRcdFx0aWYgdmFsdWUgIT0gLTFcclxuXHRcdFx0XHRlbG8gPSBnbG9iYWwucGxheWVyc1tvcHBdLmVsb1xyXG5cdFx0XHRcdEBQICs9IHZhbHVlLzJcclxuXHRcdFx0XHRpZiBlbG8gIT0gMFxyXG5cdFx0XHRcdFx0QFBSICs9IHZhbHVlLzJcclxuXHRcdFx0XHRcdEBlbG9zLnB1c2ggTWF0aC5yb3VuZCBlbG9cclxuXHJcblx0XHQjIGthbGt5bGVyYSBwZXJmb3JtYW5jZSByYXRpbmcgbWhhIHZpbnN0YW5kZWwgb2NoIGVsby10YWxcclxuXHRcdGlmIEBlbG9zLmxlbmd0aCA9PSAwIFxyXG5cdFx0XHRAUFIgPSAwXHJcblx0XHRlbHNlXHJcblx0XHRcdGFuZGVsID0gQFBSXHJcblx0XHRcdHBlcmYgPSBwZXJmb3JtYW5jZSBhbmRlbCwgQGVsb3NcclxuXHRcdFx0QFBSID0gcGVyZlxyXG5cclxuXHJcbiMgc2V0UCA9ICh0cnMsIGluZGV4LCB0cmFuc2xhdG9yKSAtPlxyXG4jIFx0c2NvcmVzUCA9IDBcclxuIyBcdHNjb3Jlc1BSID0gMFxyXG4jIFx0ZWxvcyA9IFtdXHJcbiMgXHRmb3IgciBpbiByYW5nZSBzZXR0aW5ncy5HQU1FUyAqIHNldHRpbmdzLlJPVU5EU1xyXG4jIFx0XHRjaCA9IGxvbmdzW2luZGV4XVtyXVszXVxyXG4jIFx0XHR2YWx1ZSA9ICcwMTInLmluZGV4T2YgY2hcclxuIyBcdFx0b3BwID0gbG9uZ3NbaW5kZXhdW3JdWzFdXHJcbiMgXHRcdGlmIHZhbHVlICE9IC0xXHJcbiMgXHRcdFx0ZWxvID0gcGxheWVyc1tvcHBdLmVsb1xyXG4jIFx0XHRcdHNjb3Jlc1AgKz0gdmFsdWVcclxuIyBcdFx0XHRpZiBlbG8gIT0gMFxyXG4jIFx0XHRcdFx0c2NvcmVzUFIgKz0gdmFsdWVcclxuIyBcdFx0XHRcdGVsb3MucHVzaCBNYXRoLnJvdW5kIGVsb1xyXG5cclxuIyBcdHRkUCAgPSB0cnNbdHJhbnNsYXRvcltpbmRleF1dLmNoaWxkcmVuWzMgKyBzZXR0aW5ncy5HQU1FUyAqIHNldHRpbmdzLlJPVU5EU11cclxuIyBcdHRkUC50ZXh0Q29udGVudCA9IGlmIGVsb3MubGVuZ3RoID09IDAgdGhlbiAnJyBlbHNlIChzY29yZXNQLzIpLnRvRml4ZWQgMVxyXG5cclxuIyBcdCMga2Fsa3lsZXJhIHBlcmZvcm1hbmNlIHJhdGluZyBtaGEgdmluc3RhbmRlbCBvY2ggZWxvLXRhbFxyXG4jIFx0aWYgZWxvcy5sZW5ndGggPT0gMCBcclxuIyBcdFx0cGxheWVyc1tpbmRleF0uUFIgPSAwXHJcbiMgXHRlbHNlXHJcbiMgXHRcdGFuZGVsID0gc2NvcmVzUFIvMlxyXG4jIFx0XHRwZXJmID0gcGVyZm9ybWFuY2UgYW5kZWwsIGVsb3NcclxuIyBcdFx0cGxheWVyc1tpbmRleF0uUFIgPSBwZXJmXHJcblxyXG4jIHNldFBfYWxsID0gKHRycyx0cmFuc2xhdG9yKSAtPlxyXG4jIFx0I2VjaG8gJ3NldFBfYWxsJyxsb25ncy5sZW5ndGgsdHJhbnNsYXRvci5sZW5ndGhcclxuIyBcdGZvciBpIGluIHJhbmdlIHRyYW5zbGF0b3IubGVuZ3RoXHJcbiMgXHRcdHNldFAgdHJzLGksdHJhbnNsYXRvclxyXG5cclxuIyBzZXRQUiA9ICh0cnMsIGluZGV4LCB0cmFuc2xhdG9yKSAtPlxyXG4jIFx0dGRQUiA9IHRyc1t0cmFuc2xhdG9yW2luZGV4XV0uY2hpbGRyZW5bNCArIHNldHRpbmdzLkdBTUVTICogc2V0dGluZ3MuUk9VTkRTXVxyXG4jIFx0dGRQUi50ZXh0Q29udGVudCA9IGlmIHBsYXllcnNbaW5kZXhdLlBSID09IDAgdGhlbiAnJyBlbHNlIHBsYXllcnNbaW5kZXhdLlBSLnRvRml4ZWQgc2V0dGluZ3MuREVDSU1BTFNcclxuXHJcbiMgc2V0UFJfYWxsID0gKHRycyx0cmFuc2xhdG9yKSAtPlxyXG4jIFx0Zm9yIGkgaW4gcmFuZ2UgdHJhbnNsYXRvci5sZW5ndGhcclxuIyBcdFx0c2V0UFIgdHJzLGksdHJhbnNsYXRvclxyXG5cclxuIl19
//# sourceURL=c:\github\FloatingBerger\player.coffee